pipeline {
    agent { label 'agent-1' }

    tools {
        maven 'mavn'  // Maven tool configured in Jenkins (ensure 'mavn' is configured under Global Tool Configuration)
    }

    parameters {
        string(name: 'IMAGE_NAME', defaultValue: 'myimage', description: 'Docker Image Name')
        string(name: 'DOCKERHUB_REPO_NAME', defaultValue: 'ramann123/myimage', description: 'Dockerhub repo Name')
        string(name: 'CONTAINER_NAME', defaultValue: 'ramanappcontainer', description: 'Docker Container Name')
        string(name: 'PORT_MAPPING', defaultValue: '8082:8080', description: 'Port Mapping for Docker')
    }

    environment {
        // Get the short hash of the current Git commit for versioning
        ARTIFACT_VERSION = sh(script: 'git rev-parse --short HEAD', returnStdout: true).trim()
    }

    stages {
        stage('Build') {
            steps {
                echo 'Starting Maven Build...'
                
                retry(3) {  // Retry the build step 3 times if it fails
                    timeout(time: 5, unit: 'MINUTES') {  // Set a timeout of 5 minutes
                        sh 'mvn clean package'  // Execute Maven clean and package commands
                    }
                }
            }
        }
    }
}
